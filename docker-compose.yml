version: '3.8'

services:
  app:
    build: .
    container_name: aiease-proxy
    restart: always
    ports:
      - "${PORT:-3001}:${PORT:-3001}"
    environment:
      - PORT=${PORT:-3001}
      - NODE_ENV=${NODE_ENV:-production}
      - DB_TYPE=${DB_TYPE:-mysql}
      - DB_HOST=${DB_HOST}
      - DB_PORT=${DB_PORT:-3306}
      - DB_NAME=${DB_NAME}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - JWT_SECRET=${JWT_SECRET}
      - MAX_CONCURRENT_UPSTREAM=${MAX_CONCURRENT_UPSTREAM:-10}
      # 生产环境强制启用 sync (不推荐，建议使用迁移)
      - ALLOW_SYNC_IN_PRODUCTION=${ALLOW_SYNC_IN_PRODUCTION:-false}
    networks:
      - 1panel-network

# 使用 1Panel 已有的网络，连接到现有 MySQL 容器
networks:
  1panel-network:
    external: true